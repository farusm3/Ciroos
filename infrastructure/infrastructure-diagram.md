# PetClinic Cross-Cluster Infrastructure Architecture

## AWS Multi-Region Infrastructure Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        AWS CLOUD INFRASTRUCTURE                                        │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                                    US-WEST-2 REGION (C1)                                        │   │
│  │                                                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐   │   │
│  │  │                                    VPC C1                                               │   │   │
│  │  │                               (10.0.0.0/16)                                            │   │   │
│  │  │                                                                                         │   │   │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │                            PUBLIC SUBNETS                                        │   │   │   │
│  │  │  │                    (10.0.101.0/24, 10.0.102.0/24, 10.0.103.0/24)                │   │   │   │
│  │  │  │                                                                                 │   │   │   │
│  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                 │   │   │   │
│  │  │  │  │   NAT Gateway   │  │   NAT Gateway   │  │   NAT Gateway   │                 │   │   │   │
│  │  │  │  │   (AZ-1)        │  │   (AZ-2)        │  │   (AZ-3)        │                 │   │   │   │
│  │  │  │  │                 │  │                 │  │                 │                 │   │   │   │
│  │  │  │  │ • EIP: 10.0.1.x │  │ • EIP: 10.0.2.x │  │ • EIP: 10.0.3.x │                 │   │   │   │
│  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘                 │   │   │   │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────┘   │   │   │
│  │  │                                         │                                             │   │   │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │                           PRIVATE SUBNETS                                       │   │   │   │
│  │  │  │                   (10.0.1.0/24, 10.0.2.0/24, 10.0.3.0/24)                     │   │   │   │
│  │  │  │                                                                                 │   │   │   │
│  │  │  │  ┌─────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │  │                         EKS CLUSTER C1                                 │   │   │   │
│  │  │  │  │                                                                         │   │   │   │
│  │  │  │  │  ┌─────────────────────────────────────────────────────────────────┐   │   │   │   │
│  │  │  │  │  │                    CONTROL PLANE                                │   │   │   │   │
│  │  │  │  │  │                                                                 │   │   │   │   │
│  │  │  │  │  │  • API Server (Private)                                        │   │   │   │   │
│  │  │  │  │  │  • etcd Cluster                                                │   │   │   │   │
│  │  │  │  │  │  • Scheduler                                                   │   │   │   │   │
│  │  │  │  │  │  • Controller Manager                                          │   │   │   │   │
│  │  │  │  │  │  • Cloud Controller Manager                                    │   │   │   │   │
│  │  │  │  │  └─────────────────────────────────────────────────────────────────┘   │   │   │   │
│  │  │  │  │                                                                         │   │   │   │
│  │  │  │  │  ┌─────────────────────────────────────────────────────────────────┐   │   │   │   │
│  │  │  │  │  │                    WORKER NODES                                │   │   │   │   │
│  │  │  │  │  │                                                                 │   │   │   │   │
│  │  │  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │   │   │   │   │
│  │  │  │  │  │  │   Node Group    │  │   Node Group    │  │   Node Group    │ │   │   │   │   │
│  │  │  │  │  │  │   (AZ-1)        │  │   (AZ-2)        │  │   (AZ-3)        │ │   │   │   │   │
│  │  │  │  │  │  │                 │  │                 │  │                 │ │   │   │   │   │
│  │  │  │  │  │  │ • t3.medium     │  │ • t3.medium     │  │ • t3.medium     │ │   │   │   │   │
│  │  │  │  │  │  │ • Auto Scaling  │  │ • Auto Scaling  │  │ • Auto Scaling  │ │   │   │   │   │
│  │  │  │  │  │  │ • 1-4 nodes     │  │ • 1-4 nodes     │  │ • 1-4 nodes     │ │   │   │   │   │
│  │  │  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘ │   │   │   │   │
│  │  │  │  │  └─────────────────────────────────────────────────────────────────┘   │   │   │   │
│  │  │  │  │                                                                         │   │   │   │
│  │  │  │  │  ┌─────────────────────────────────────────────────────────────────┐   │   │   │   │
│  │  │  │  │  │                    APPLICATIONS (C1)                           │   │   │   │   │
│  │  │  │  │  │                                                                 │   │   │   │   │
│  │  │  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │   │   │   │   │
│  │  │  │  │  │  │   Customers     │  │   API Gateway   │  │   Config Server │ │   │   │   │   │
│  │  │  │  │  │  │   Service       │  │                 │  │                 │ │   │   │   │   │
│  │  │  │  │  │  │                 │  │ • Route Rules   │  │ • Centralized   │ │   │   │   │   │
│  │  │  │  │  │  │ • Owner Data    │  │ • Load Balancer │  │   Config        │ │   │   │   │   │
│  │  │  │  │  │  │ • Pet Data      │  │ • Circuit       │  │ • Git Backend   │ │   │   │   │   │
│  │  │  │  │  │  │ • Pet Types     │  │   Breaker       │  │ • Profiles      │ │   │   │   │   │
│  │  │  │  │  │  │ • Port 8080     │  │ • Port 8080     │  │ • Port 8888     │ │   │   │   │   │
│  │  │  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘ │   │   │   │   │
│  │  │  │  │  │                                                                 │   │   │   │   │
│  │  │  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │   │   │   │   │
│  │  │  │  │  │  │   Discovery     │  │   Admin Server  │  │   Monitoring    │ │   │   │   │   │
│  │  │  │  │  │  │   Server        │  │                 │  │   Stack         │ │   │   │   │   │
│  │  │  │  │  │  │                 │  │ • Health Check  │  │                 │   │   │   │   │
│  │  │  │  │  │  │ • Eureka        │  │ • Metrics       │  │ • Prometheus    │   │   │   │   │
│  │  │  │  │  │  │ • Service Reg   │  │ • Management    │  │ • Grafana       │   │   │   │   │
│  │  │  │  │  │  │ • Port 8761     │  │ • Port 9090     │  │ • AlertManager  │   │   │   │   │
│  │  │  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘ │   │   │   │   │
│  │  │  │  │  └─────────────────────────────────────────────────────────────────┘   │   │   │   │
│  │  │  │  └─────────────────────────────────────────────────────────────────────────┘   │   │   │
│  │  │  │                                                                                 │   │   │
│  │  │  │  ┌─────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │  │                        LOAD BALANCER                                   │   │   │   │
│  │  │  │  │                                                                         │   │   │   │
│  │  │  │  │  ┌─────────────────────────────────────────────────────────────────┐   │   │   │   │
│  │  │  │  │  │                   APPLICATION LOAD BALANCER                     │   │   │   │   │
│  │  │  │  │  │                                                                 │   │   │   │   │
│  │  │  │  │  │  • Internal ALB (Private)                                      │   │   │   │   │
│  │  │  │  │  │  • SSL/TLS Termination                                        │   │   │   │   │
│  │  │  │  │  │  • Health Checks                                              │   │   │   │   │
│  │  │  │  │  │  • Target Groups                                              │   │   │   │   │
│  │  │  │  │  │  • WAF Integration                                            │   │   │   │   │
│  │  │  │  │  └─────────────────────────────────────────────────────────────────┘   │   │   │   │
│  │  │  │  └─────────────────────────────────────────────────────────────────────────┘   │   │   │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────┘   │   │
│  │  │                                         │                                             │   │   │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │                            SECURITY CONTROLS                                   │   │   │   │
│  │  │  │                                                                                 │   │   │   │
│  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                 │   │   │   │
│  │  │  │  │   AWS WAF       │  │  Security       │  │  Network ACLs   │                 │   │   │   │
│  │  │  │  │                 │  │  Groups         │  │                 │                 │   │   │   │
│  │  │  │  │ • Geo Blocking  │  │                 │  │ • Inbound Rules │                 │   │   │   │
│  │  │  │  │ • SQL Injection │  │ • EKS Cluster   │  │ • Outbound Rules│                 │   │   │   │
│  │  │  │  │ • XSS Protection│  │ • Node Groups   │  │ • Port Control  │                 │   │   │   │
│  │  │  │  │ • Rate Limiting │  │ • ALB Access    │  │ • CIDR Filtering│                 │   │   │   │
│  │  │  │  │ • DDoS Protect  │  │ • Cross-Cluster │  │ • Protocol      │                 │   │   │   │
│  │  │  │  └─────────────────┘  └─────────────────┘  │   Restrictions  │                 │   │   │   │
│  │  │  │                                          └─────────────────┘                 │   │   │   │
│  │  │  │                                                                                 │   │   │   │
│  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                 │   │   │   │
│  │  │  │  │   VPC Endpoints │  │   KMS Keys      │  │   IAM Roles     │                 │   │   │   │
│  │  │  │  │                 │  │                 │  │                 │                 │   │   │   │
│  │  │  │  │ • S3 Access     │  │ • EKS Secrets   │  │ • EKS Cluster   │                 │   │   │   │
│  │  │  │  │ • EC2 API       │  │   Encryption    │  │ • Node Groups   │                 │   │   │   │
│  │  │  │  │ • ECR Access    │  │ • Data at Rest  │  │ • Service       │                 │   │   │   │
│  │  │  │  │ • Private Link  │  │ • Key Rotation  │  │   Accounts      │                 │   │   │   │
│  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘                 │   │   │   │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────┘   │   │   │
│  │  └─────────────────────────────────────────────────────────────────────────────────────┘   │   │
│  │                                         │                                                     │   │   │
│  │                                         │                                                     │   │   │
│  │                                         │                                                     │   │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐   │   │
│  │  │                            TRANSIT GATEWAY CONNECTION                                  │   │   │
│  │  │                                                                                         │   │   │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │                        VPC ATTACHMENT C1                                        │   │   │   │
│  │  │  │                                                                                 │   │   │   │
│  │  │  │  • Route Table: Cross-Cluster Communication                                     │   │   │   │
│  │  │  │  • Propagation: C1 ↔ C2                                                        │   │   │   │
│  │  │  │  • Association: Private Subnets                                                 │   │   │   │
│  │  │  │  • CIDR: 10.0.0.0/16 → 10.1.0.0/16                                            │   │   │   │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────┘   │   │   │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────┘   │   │
│  │                                         │                                                     │   │   │
│  │                                         │                                                     │   │   │
│  │                                         │                                                     │   │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐   │   │
│  │  │                              TRANSIT GATEWAY                                           │   │   │
│  │  │                                                                                         │   │   │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │                         CROSS-REGION ROUTING                                     │   │   │   │
│  │  │  │                                                                                 │   │   │   │
│  │  │  │  • Route Table: Custom Cross-Cluster                                            │   │   │   │
│  │  │  │  • CIDR Routes: 10.0.0.0/16 ↔ 10.1.0.0/16                                      │   │   │   │
│  │  │  │  • DNS Support: Enabled                                                         │   │   │   │
│  │  │  │  • VPN ECMP: Enabled                                                            │   │   │   │
│  │  │  │  • Auto Accept: Cross-Account Attachments                                       │   │   │   │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────┘   │   │   │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                                    US-EAST-1 REGION (C2)                                        │   │
│  │                                                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐   │   │
│  │  │                                    VPC C2                                               │   │   │
│  │  │                               (10.1.0.0/16)                                            │   │   │
│  │  │                                                                                         │   │   │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │                            PUBLIC SUBNETS                                        │   │   │   │
│  │  │  │                    (10.1.101.0/24, 10.1.102.0/24, 10.1.103.0/24)                │   │   │   │
│  │  │  │                                                                                 │   │   │   │
│  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                 │   │   │   │
│  │  │  │  │   NAT Gateway   │  │   NAT Gateway   │  │   NAT Gateway   │                 │   │   │   │
│  │  │  │  │   (AZ-1)        │  │   (AZ-2)        │  │   (AZ-3)        │                 │   │   │   │
│  │  │  │  │                 │  │                 │  │                 │                 │   │   │   │
│  │  │  │  │ • EIP: 10.1.1.x │  │ • EIP: 10.1.2.x │  │ • EIP: 10.1.3.x │                 │   │   │   │
│  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘                 │   │   │   │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────┘   │   │   │
│  │  │                                         │                                             │   │   │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │                           PRIVATE SUBNETS                                       │   │   │   │
│  │  │  │                   (10.1.1.0/24, 10.1.2.0/24, 10.1.3.0/24)                     │   │   │   │
│  │  │  │                                                                                 │   │   │   │
│  │  │  │  ┌─────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │  │                         EKS CLUSTER C2                                 │   │   │   │
│  │  │  │  │                                                                         │   │   │   │
│  │  │  │  │  ┌─────────────────────────────────────────────────────────────────┐   │   │   │   │
│  │  │  │  │  │                    CONTROL PLANE                                │   │   │   │   │
│  │  │  │  │  │                                                                 │   │   │   │   │
│  │  │  │  │  │  • API Server (Private)                                        │   │   │   │   │
│  │  │  │  │  │  • etcd Cluster                                                │   │   │   │   │
│  │  │  │  │  │  • Scheduler                                                   │   │   │   │   │
│  │  │  │  │  │  • Controller Manager                                          │   │   │   │   │
│  │  │  │  │  │  • Cloud Controller Manager                                    │   │   │   │   │
│  │  │  │  │  └─────────────────────────────────────────────────────────────────┘   │   │   │   │
│  │  │  │  │                                                                         │   │   │   │
│  │  │  │  │  ┌─────────────────────────────────────────────────────────────────┐   │   │   │   │
│  │  │  │  │  │                    WORKER NODES                                │   │   │   │   │
│  │  │  │  │  │                                                                 │   │   │   │   │
│  │  │  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │   │   │   │   │
│  │  │  │  │  │  │   Node Group    │  │   Node Group    │  │   Node Group    │ │   │   │   │   │
│  │  │  │  │  │  │   (AZ-1)        │  │   (AZ-2)        │  │   (AZ-3)        │ │   │   │   │   │
│  │  │  │  │  │  │                 │  │                 │  │                 │ │   │   │   │   │
│  │  │  │  │  │  │ • t3.medium     │  │ • t3.medium     │  │ • t3.medium     │ │   │   │   │   │
│  │  │  │  │  │  │ • Auto Scaling  │  │ • Auto Scaling  │  │ • Auto Scaling  │ │   │   │   │   │
│  │  │  │  │  │  │ • 1-4 nodes     │  │ • 1-4 nodes     │  │ • 1-4 nodes     │ │   │   │   │   │
│  │  │  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘ │   │   │   │   │
│  │  │  │  │  └─────────────────────────────────────────────────────────────────┘   │   │   │   │
│  │  │  │  │                                                                         │   │   │   │
│  │  │  │  │  ┌─────────────────────────────────────────────────────────────────┐   │   │   │   │
│  │  │  │  │  │                    APPLICATIONS (C2)                           │   │   │   │   │
│  │  │  │  │  │                                                                 │   │   │   │   │
│  │  │  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │   │   │   │   │
│  │  │  │  │  │  │   Visits        │  │   GenAI         │  │   Admin Server  │ │   │   │   │   │
│  │  │  │  │  │  │   Service       │  │   Service       │  │                 │ │   │   │   │   │
│  │  │  │  │  │  │                 │  │                 │  │ • Health Check  │ │   │   │   │   │
│  │  │  │  │  │  │ • Visit Records │  │ • OpenAI/Azure  │  │ • Metrics       │ │   │   │   │   │
│  │  │  │  │  │  │ • Pet Visits    │  │   OpenAI        │  │ • Management    │ │   │   │   │   │
│  │  │  │  │  │  │ • Cross-Cluster │  │ • Chat Interface│  │ • Port 9090     │ │   │   │   │   │
│  │  │  │  │  │  │   Calls to C1   │  │ • Function      │  │                 │ │   │   │   │   │
│  │  │  │  │  │  │ • Port 8080     │  │   Calling       │  │                 │ │   │   │   │   │
│  │  │  │  │  │  └─────────────────┘  │ • Port 8080     │  └─────────────────┘ │   │   │   │   │
│  │  │  │  │  │                        └─────────────────┘                     │   │   │   │   │
│  │  │  │  │  └─────────────────────────────────────────────────────────────────┘   │   │   │   │
│  │  │  │  └─────────────────────────────────────────────────────────────────────────┘   │   │   │
│  │  │  │                                                                                 │   │   │
│  │  │  │  ┌─────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │  │                        LOAD BALANCER                                   │   │   │   │
│  │  │  │  │                                                                         │   │   │   │
│  │  │  │  │  ┌─────────────────────────────────────────────────────────────────┐   │   │   │   │
│  │  │  │  │  │                   APPLICATION LOAD BALANCER                     │   │   │   │   │
│  │  │  │  │  │                                                                 │   │   │   │   │
│  │  │  │  │  │  • Internal ALB (Private)                                      │   │   │   │   │
│  │  │  │  │  │  • SSL/TLS Termination                                        │   │   │   │   │
│  │  │  │  │  │  • Health Checks                                              │   │   │   │   │
│  │  │  │  │  │  • Target Groups                                              │   │   │   │   │
│  │  │  │  │  │  • WAF Integration                                            │   │   │   │   │
│  │  │  │  │  └─────────────────────────────────────────────────────────────────┘   │   │   │   │
│  │  │  │  └─────────────────────────────────────────────────────────────────────────┘   │   │   │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────┘   │   │
│  │  │                                         │                                             │   │   │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │                            SECURITY CONTROLS                                   │   │   │   │
│  │  │  │                                                                                 │   │   │   │
│  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                 │   │   │   │
│  │  │  │  │   AWS WAF       │  │  Security       │  │  Network ACLs   │                 │   │   │   │
│  │  │  │  │                 │  │  Groups         │  │                 │                 │   │   │   │
│  │  │  │  │ • Geo Blocking  │  │                 │  │ • Inbound Rules │                 │   │   │   │
│  │  │  │  │ • SQL Injection │  │ • EKS Cluster   │  │ • Outbound Rules│                 │   │   │   │
│  │  │  │  │ • XSS Protection│  │ • Node Groups   │  │ • Port Control  │                 │   │   │   │
│  │  │  │  │ • Rate Limiting │  │ • ALB Access    │  │ • CIDR Filtering│                 │   │   │   │
│  │  │  │  │ • DDoS Protect  │  │ • Cross-Cluster │  │ • Protocol      │                 │   │   │   │
│  │  │  │  └─────────────────┘  └─────────────────┘  │   Restrictions  │                 │   │   │   │
│  │  │  │                                          └─────────────────┘                 │   │   │   │
│  │  │  │                                                                                 │   │   │   │
│  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                 │   │   │   │
│  │  │  │  │   VPC Endpoints │  │   KMS Keys      │  │   IAM Roles     │                 │   │   │   │
│  │  │  │  │                 │  │                 │  │                 │                 │   │   │   │
│  │  │  │  │ • S3 Access     │  │ • EKS Secrets   │  │ • EKS Cluster   │                 │   │   │   │
│  │  │  │  │ • EC2 API       │  │   Encryption    │  │ • Node Groups   │                 │   │   │   │
│  │  │  │  │ • ECR Access    │  │ • Data at Rest  │  │ • Service       │                 │   │   │   │
│  │  │  │  │ • Private Link  │  │ • Key Rotation  │  │   Accounts      │                 │   │   │   │
│  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘                 │   │   │   │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────┘   │   │   │
│  │  └─────────────────────────────────────────────────────────────────────────────────────┘   │   │
│  │                                         │                                                     │   │   │
│  │                                         │                                                     │   │   │
│  │                                         │                                                     │   │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐   │   │
│  │  │                            TRANSIT GATEWAY CONNECTION                                  │   │   │
│  │  │                                                                                         │   │   │
│  │  │  ┌─────────────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │                        VPC ATTACHMENT C2                                        │   │   │   │
│  │  │  │                                                                                 │   │   │   │
│  │  │  │  • Route Table: Cross-Cluster Communication                                     │   │   │   │
│  │  │  │  • Propagation: C2 ↔ C1                                                        │   │   │   │
│  │  │  │  • Association: Private Subnets                                                 │   │   │   │
│  │  │  │  • CIDR: 10.1.0.0/16 → 10.0.0.0/16                                            │   │   │   │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────┘   │   │   │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                              MONITORING & OBSERVABILITY                                        │   │
│  │                                                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐   │   │
│  │  │                         PROMETHEUS & GRAFANA STACK                                      │   │   │
│  │  │                                                                                         │   │   │
│  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │   │   │
│  │  │  │   Prometheus    │  │     Grafana     │  │  AlertManager   │  │   Chaos Monkey  │   │   │   │
│  │  │  │                 │  │                 │  │                 │  │                 │   │   │   │
│  │  │  │ • Metrics       │  │ • Dashboards    │  │ • Alert Routing │  │ • Fault         │   │   │   │
│  │  │  │   Collection    │  │ • Visualization │  │ • Notification  │  │   Injection     │   │   │   │
│  │  │  │ • Scrape Config │  │ • Custom        │  │ • Grouping      │  │ • Latency       │   │   │   │
│  │  │  │ • Alert Rules   │  │   Dashboards    │  │ • Deduplication │  │ • Exceptions    │   │   │   │
│  │  │  │ • Storage       │  │ • Multi-Cluster │  │ • Silence       │  │ • Memory        │   │   │   │
│  │  │  │ • Query Engine  │  │   Monitoring    │  │ • Webhooks      │  │ • Network       │   │   │   │
│  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘   │   │   │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘

## Cross-Cluster Communication Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                              CROSS-CLUSTER COMMUNICATION FLOW                                         │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                                   REQUEST FLOW                                                   │   │
│  │                                                                                                 │   │
│  │  1. User Request → API Gateway (C1) → Visits Service (C2)                                      │   │
│  │  2. Visits Service (C2) → Customers Service (C1) [Cross-Cluster Call]                          │   │
│  │  3. Response: Customers Service (C1) → Visits Service (C2) → API Gateway (C1) → User           │   │
│  │                                                                                                 │   │
│  │  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐   │   │   │
│  │  │   User          │    │   API Gateway   │    │  Visits Service │    │ Customers Service│   │   │   │
│  │  │   Request       │───▶│      (C1)       │───▶│      (C2)       │───▶│      (C1)       │   │   │   │
│  │  │                 │    │                 │    │                 │    │                 │   │   │   │
│  │  │ • HTTP/HTTPS    │    │ • Route Rules   │    │ • Visit Records │    │ • Owner Data    │   │   │   │
│  │  │ • Load Balancer │    │ • Circuit       │    │ • Pet Visits    │    │ • Pet Data      │   │   │   │
│  │  │ • WAF Protection│    │   Breaker       │    │ • Cross-Cluster │    │ • Pet Types     │   │   │   │
│  │  │ • SSL/TLS       │    │ • Retry Logic   │    │   Communication │    │ • Database      │   │   │   │
│  │  └─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘   │   │   │
│  │                                                                                                 │   │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐   │   │   │
│  │  │                            NETWORK PATH                                                  │   │   │   │
│  │  │                                                                                         │   │   │   │
│  │  │  C1 Pod → C1 Service → C1 ALB → Transit Gateway → C2 ALB → C2 Service → C2 Pod         │   │   │   │
│  │  │                                                                                         │   │   │   │
│  │  │  • Private Subnets Only                                                                │   │   │   │
│  │  │  • Transit Gateway Routing                                                             │   │   │   │
│  │  │  • Security Groups & NACLs                                                             │   │   │   │
│  │  │  • Kubernetes Network Policies                                                         │   │   │   │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────┘   │   │   │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                                 MONITORING FLOW                                                  │   │
│  │                                                                                                 │   │
│  │  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐   │   │   │
│  │  │   Application   │    │   Prometheus    │    │     Grafana     │    │  AlertManager   │   │   │   │
│  │  │   Metrics       │───▶│   Collection    │───▶│   Dashboards    │───▶│   Alerts        │   │   │   │
│  │  │                 │    │                 │    │                 │    │                 │   │   │   │
│  │  │ • HTTP Requests │    │ • Scrape Config │    │ • Real-time     │    │ • Cross-Cluster │   │   │   │
│  │  │ • Response Time │    │ • Storage       │    │   Monitoring    │    │   Failures      │   │   │   │
│  │  │ • Error Rates   │    │ • Alert Rules   │    │ • Custom        │    │ • SLA Breaches  │   │   │   │
│  │  │ • Business      │    │ • Query Engine  │    │   Dashboards    │    │ • Notifications │   │   │   │
│  │  │   Metrics       │    │ • Cross-Cluster │    │ • Multi-Cluster │    │ • Webhooks      │   │   │   │
│  │  └─────────────────┘    │   Metrics       │    │   Views         │    └─────────────────┘   │   │   │
│  │                         └─────────────────┘    └─────────────────┘                        │   │   │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## Key Infrastructure Components

### **Networking Architecture**
- **VPCs**: Isolated network environments (10.0.0.0/16 and 10.1.0.0/16)
- **Subnets**: Private subnets for applications, public subnets for NAT gateways
- **Transit Gateway**: Cross-region connectivity with custom routing
- **NAT Gateways**: Outbound internet access from private subnets
- **Route Tables**: Custom routing for cross-cluster communication

### **Security Layers**
- **WAF**: Web application firewall with geo-blocking, SQL injection, XSS protection
- **Security Groups**: Instance-level access control
- **Network ACLs**: Subnet-level security controls
- **Kubernetes Network Policies**: Pod-level network segmentation
- **VPC Endpoints**: Private AWS service access

### **Compute Infrastructure**
- **EKS Clusters**: Managed Kubernetes in each region
- **Node Groups**: Auto-scaling worker nodes (t3.medium)
- **Load Balancers**: Internal ALBs with SSL/TLS termination
- **Container Registry**: ECR for container images

### **Monitoring Stack**
- **Prometheus**: Metrics collection and alerting
- **Grafana**: Visualization and dashboards
- **AlertManager**: Alert routing and notifications
- **Chaos Monkey**: Fault injection and resilience testing

### **Data & Storage**
- **KMS**: Encryption keys for EKS secrets
- **VPC Endpoints**: Private access to S3, ECR, EC2 APIs
- **Container Storage**: EBS volumes for persistent data
- **Backup**: Automated backup strategies

This infrastructure provides enterprise-grade security, high availability, comprehensive monitoring, and seamless cross-cluster communication for the PetClinic microservices application.
